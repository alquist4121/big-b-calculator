# Big-B Calculator 初期プロンプト

あなたは熟練のDartエンジニアです。次の仕様に沿って「Big-B（5-card Badugi & 5-card Hidugi）」の**1回のドロー後の到達役確率**を厳密計算するCLIツールを実装してください。推測や近似ではなく**全列挙**で正確な確率を出力します。

## 目的
- 入力: 5枚ハンド＋チェンジ（交換）する枚数と対象カード
- 交換後（1ドロー後）に、**Badugi部門**と**Hidugi部門**それぞれで到達しうる役の確率分布を出力
- 出力は「役カテゴリごとの確率（%）」「代表例ハンド（任意1つ）」を行ごとに表示
- 47枚からk枚（k = チェンジ数）を**全列挙**して厳密確率を求める

## ルール（このツールが評価・計数すべき定義）

### 共通
- デッキはジョーカーなしの52枚。表記はランク[A,K,Q,J,T,9..2]＋スート[c,d,h,s]。
- 入力ハンドの5枚と、交換対象に指定されたカードは山札から除外してから新規に補充する。
- 1回のドローのみ（トリプルドロー全体のシミュレーションは不要）。

### Badugi（ローハンド部門の役判定）
- 5枚から**スート全異**かつ**ランク全異**の**最も低い4枚**を選ぶ（=4枚Badugi）。作れない場合は3/2/1/0枚のうち最大枚数を採用する。
- **集計カテゴリ（枚数）**は以下の3つのみ：
  - `Badugi` … **4枚**で成立した場合
  - `tri` … **3枚**で成立した場合
  - `no-badugi` … **2枚・1枚・0枚**の場合は全てここに合算
- 優劣比較（代表例選定のみ必要）：同じ枚数なら**より低い（Aが最小）ほど強い**。エースは**常にロー**（A < 2 < … < K）。
- 代表例表示用の比較は、採用したN枚を**昇順（A最小）**に並べた**辞書順**で最良のものを採用してよい。

### Hidugi（ハイハンド部門の役判定）
- 5枚から**スートが全て異なる4枚**を選び、その4枚で**通常ハイポーカー準拠**の強さで比較する（Aは**ハイ**）。
- 4枚を選べない（=ハンド内のスート種類が3以下）場合は `no-hidugi`。
- 成立しうる主なカテゴリ（強い順）：
  1. **quads**（Four of a Kind）
  2. **trips**（Three of a Kind）
  3. **two-pair**
  4. **one-pair**
  5. **high-card**
- 4枚役なので**フラッシュは起こりえない**（4スート異色必須のため）／**ストレートは便宜上スコアに影響させない**（＝high-card比較に吸収）。
- 同カテゴリの優劣（代表例選定に必要。集計はカテゴリ単位でOK）：
  - quads：四枚のランクが高いほど強い（A高）。
  - trips：三枚のランク→残り1枚のキッカーで比較。
  - two-pair：高いペア→低いペア→キッカーで比較。
  - one-pair：ペアランク→残り2枚のキッカー高い順。
  - high-card：ランクを**降順（A最大）**に並べた**辞書順**比較。

## 入出力仕様（CLI）

### 実行例（入力）
    bigb_calc --hand As2c5d5sKs --discard 5s,Ks

- `--hand` は5枚を**ランク+スート**連結で指定（順不同可）
- `--discard` は手放すカードを**カード表記またはインデックス**で指定できるようにすること（どちらか一方でも可）。
  - 例1）`--discard 5s,Ks`（カード指定）
  - 例2）`--discard 4,5`（インデックス指定：1始まり、入力ハンドの表示順を基準）
- `--json` 指定時はJSONも併出（テキストと同等情報）。

### 出力（例）
    Total outcomes: 1081 (draw 2 from 47)
    Hidugi:
      quads             0.185%   (example: As 5d 5h 5c)
      trips             6.203%   (example: As 5d 5h Qc)
      two-pair          9.167%   (example: As Qc Qd 5h)
      one-pair         31.812%   (example: As Kc Qd 5h)
      high-card        12.025%   (example: As Kc Qd Jh)
      no-hidugi        40.608%

    Badugi:
      Badugi            7.680%   (example: Ac 2d 5h Qs)
      tri              24.789%   (example: Ac 2d 5h 5s)
      no-badugi        67.531%

- 百分率は小数点3桁表示（丸め）。
- `Total outcomes` は組合せ数 C(47, k)。
- 代表例はそのカテゴリに属する任意の1ハンド（同列挙内の最良基準でよい）。

## 実装要件（Dart）
- Dart 3系／NNBD（null safety）。外部パッケージに依存しない標準実装推奨。ただし`args`パッケージの使用は可。
- プロジェクト名: `bigb_calc`、エントリーポイント: `bin/bigb_calc.dart`

### 主な構成
- `card.dart`：`Card{rank:int,suit:int}`, パース/表示, ランク変換（Badugi用はA=1、Hidugi用はA=14も扱えるようヘルパ）
- `hand_eval_badugi.dart`：Badugi評価（最良N枚選択、N=4..1）。**集計カテゴリは Badugi/tri/no-badugi** にマップすること（2枚・1枚はno-badugi）。
- `hand_eval_hidugi.dart`：Hidugi評価（全スート異なる4枚選択→カテゴリ決定→比較器）
- `enumerator.dart`：残りデッキから`k`枚の**組合せ全列挙**（反復生成器）
- `cli.dart`：引数処理、結果集計/整形出力（textおよび`--json`）

## 詳細仕様

### パース
- ランク文字→数値：
  - Hidugi用：A=14,K=13,Q=12,J=11,T=10,9..2
  - Badugi用：A=1,K=13,Q=12,J=11,T=10,9..2
- スート文字：c=0, d=1, h=2, s=3（任意の固定）
- 入力検証：重複カードの混入、無効文字、捨て札が手札に含まれない等はエラー終了（コード≠0）。

### 評価アルゴリズム（要点）

#### Badugi
1. 5枚から**最大**で4枚のBadugiを作る。
   - スート重複・ランク重複を避ける4枚集合の中で、**最も低い**ものを選ぶ。
   - 4枚が無理なら3枚、それも無理なら2/1/0枚。
2. カテゴリ付与：
   - 4枚→`Badugi`、3枚→`tri`、2/1/0枚→`no-badugi`。
3. 代表例比較用に（採用集合を**ランク昇順**）**辞書順**最小を覚えておく。

#### Hidugi
1. 5枚から**スートが全て異なる4枚の部分集合**を全探索し、各集合の**役カテゴリ**を決定。
2. カテゴリは `quads/trips/two-pair/one-pair/high-card` のいずれか。
3. 比較規則に従って各カテゴリ内のベストを選び代表例にする。
4. 4スート揃わない場合は `no-hidugi`。

### 出力整形
- パーセンテージ = `count / total * 100` を小数点3桁（四捨五入）。
- テキスト表：カテゴリ名を左寄せ幅そろえ、代表例は半角スペース区切りのカード4枚表示。
- JSON例（`--json`指定時）：

    {
      "total": 1081,
      "hidugi": {
        "quads": {"pct":0.185,"example":["As","5d","5h","5c"]},
        "trips": {"pct":6.203,"example":["As","5d","5h","Qc"]},
        "no-hidugi": {"pct":40.608}
      },
      "badugi": {
        "Badugi":{"pct":7.680,"example":["Ac","2d","5h","Qs"]},
        "tri":{"pct":24.789,"example":["Ac","2d","5h","5s"]},
        "no-badugi":{"pct":67.531}
      }
    }

## テスト（最低限）
1. `--hand As2c5d5sKs --discard 5s,Ks`
   - 合計組合せ `C(47,2)=1081` を表示すること。
   - 代表例が正しい形式で表示されること（内容は固定不要）。
2. 4スート無いケースで `no-hidugi` が非ゼロになること。
3. Badugiで重複ランク/スートだらけのとき `no-badugi` が非ゼロになること。
4. 不正入力（重複カード等）でエラー終了。

## 仕上げ
- 実行例：
    dart run bin/bigb_calc.dart --hand As2c5d5sKs --discard 5s,Ks
- READMEに使い方と計算根拠（組合せ全列挙）を記載。
- コードは読みやすい関数分割とコメントを付与。

この仕様に厳密に従って、Dartコード一式を生成してください。
